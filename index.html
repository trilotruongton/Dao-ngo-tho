<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TrÃ­ Lá»™ TrÆ°á»ng Tá»“n - Ebook</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/png" href="images/favicon.png">
</head>
<body>

<header>
  <div class="brand">
    <img src="images/favicon.png" class="qr">
    <h1>TrÃ­ Lá»™ TrÆ°á»ng Tá»“n</h1>
  </div>
  <button id="cartBtn">ğŸ›’ Giá» hÃ ng (<span id="cartCount">0</span>)</button>
</header>

<main>
  <h2>Danh sÃ¡ch Ebook</h2>

  <div class="book-list">

    <div class="book">
      <img src="images/tuyet-mat-nhan-tinh.jpg">
      <h4>Tuyá»‡t Máº­t NhÃ¢n TÃ­nh</h4>
      <p><del>50.000Ä‘</del> â <strong>0Ä‘, sÃ¡ch táº·ng</strong></p>
      <a href="previews/tuyet-mat-nhan-tinh-doc-thu.pdf" target="_blank">ğŸ“– Äá»c thá»­</a><br>
      <button onclick="downloadFree()">Táº£i miá»…n phÃ­</button>
    </div>

    <div class="book">
      <img src="images/nhan-tinh-den-trang.jpg">
      <h4>NhÃ¢n TÃ­nh Äen Tráº¯ng</h4>
      <p><del>120.000Ä‘</del> â <strong>90.000Ä‘</strong></p>
      <a href="previews/nhan-tinh-den-trang-doc-thu.pdf" target="_blank">ğŸ“– Äá»c thá»­</a><br>
      <button onclick="addToCart(2)">ThÃªm vÃ o giá»</button>
    </div>

    <div class="book">
      <img src="images/tu-duy-sau-sac.jpg">
      <h4>TÆ° Duy SÃ¢u Sáº¯c</h4>
      <p><del>200.000Ä‘</del> â <strong>150.000Ä‘</strong></p>
      <a href="previews/tu-duy-sau-sac-doc-thu.pdf" target="_blank">ğŸ“– Äá»c thá»­</a><br>
      <button onclick="addToCart(3)">ThÃªm vÃ o giá»</button>
    </div>

    <div class="book">
      <img src="images/thien-co-38-cuc.jpg">
      <h4>ThiÃªn CÆ¡ 38 Cá»¥c</h4>
      <p><del>170.000Ä‘</del> â <strong>120.000Ä‘</strong></p>
      <a href="previews/thien-co-38-cuc-doc-thu.pdf" target="_blank">ğŸ“– Äá»c thá»­</a><br>
      <button onclick="addToCart(4)">ThÃªm vÃ o giá»</button>
    </div>

    <div class="book">
      <img src="images/kiem-dai.jpg">
      <h4>Kiáº¿m Äáº¡i</h4>
      <p><del>120.000Ä‘</del> â <strong>90.000Ä‘</strong></p>
      <button onclick="addToCart(5)">ThÃªm vÃ o giá»</button>
    </div>

    <div class="book">
      <img src="images/logic-nguoi-ngheo.jpg">
      <h4>Logic NgÆ°á»i NghÃ¨o</h4>
      <p><del>170.000Ä‘</del> â <strong>100.000Ä‘</strong></p>
      <a href="previews/logic-nguoi-ngheo-doc-thu.pdf" target="_blank">ğŸ“– Äá»c thá»­</a><br>
      <button onclick="addToCart(6)">ThÃªm vÃ o giá»</button>
    </div>

  </div>
</main>

<!-- GIá» HÃ€NG -->
<div id="cartModal" class="modal">
  <div class="modal-content">
    <button id="closeCart">&times;</button>
    <h3>Giá» hÃ ng</h3>
    <div id="cartItems"></div>
    <button id="checkoutBtn">Äáº·t hÃ ng</button>
  </div>
</div>

<!-- CHECKOUT -->
<div id="checkoutModal" class="modal">
  <div class="modal-content">
    <button id="closeCheckout">&times;</button>
    <h3>ThÃ´ng tin Ä‘áº·t hÃ ng</h3>

    <form id="orderForm"
      action="https://formsubmit.co/vang11112006@gmail.com"
      method="POST">

      <input type="hidden" name="_next" value="thankyou.html">
      <input type="hidden" name="_subject" value="ÄÆ¡n hÃ ng Ebook má»›i">
      <input type="hidden" name="_captcha" value="false">

      <input type="hidden" name="MÃ£ Ä‘Æ¡n hÃ ng" id="orderCode">
      <input type="hidden" name="ÄÆ¡n hÃ ng" id="orderDetail">
      <input type="hidden" name="Tá»•ng tiá»n" id="orderTotal">

      <input type="text" name="Há» tÃªn" placeholder="Há» vÃ  tÃªn" required>
      <input type="email" name="Email" placeholder="Email" required>
      <input type="text" name="SÄT" placeholder="Sá»‘ Ä‘iá»‡n thoáº¡i">
      <textarea name="Ghi chÃº" placeholder="Ghi chÃº thÃªm"></textarea>

      <button type="submit">Gá»­i Ä‘Æ¡n</button>
    </form>

  </div>
</div>

<script>
const books = [
  { id: 2, title: "NhÃ¢n TÃ­nh Äen Tráº¯ng", price: 90000 },
  { id: 3, title: "TÆ° Duy SÃ¢u Sáº¯c", price: 150000 },
  { id: 4, title: "ThiÃªn CÆ¡ 38 Cá»¥c", price: 120000 },
  { id: 5, title: "Kiáº¿m Äáº¡i", price: 90000 },
  { id: 6, title: "Logic NgÆ°á»i NghÃ¨o", price: 100000 }
];

const CART_KEY = "ebook_cart";
const cartCount = document.getElementById("cartCount");
const cartItems = document.getElementById("cartItems");

function formatVND(x){
  return x.toLocaleString("vi-VN")+"â‚«";
}

function loadCart(){
  return JSON.parse(localStorage.getItem(CART_KEY)||"[]");
}

function saveCart(c){
  localStorage.setItem(CART_KEY,JSON.stringify(c));
}

function updateCartCount(){
  cartCount.textContent = loadCart().reduce((s,i)=>s+i.qty,0);
}

function addToCart(id){
  let c = loadCart();
  let i = c.find(x=>x.id===id);
  i ? i.qty++ : c.push({id,qty:1});
  saveCart(c);
  updateCartCount();
  alert("ÄÃ£ thÃªm vÃ o giá» hÃ ng");
}

function renderCart(){
  let c = loadCart(), total=0;
  cartItems.innerHTML = c.map(ci=>{
    let b = books.find(x=>x.id===ci.id);
    let sub = b.price*ci.qty;
    total+=sub;
    return `<p>${b.title} x ${ci.qty} = ${formatVND(sub)}</p>`;
  }).join("") + `<hr><strong>Tá»•ng: ${formatVND(total)}</strong>`;
}

document.getElementById("cartBtn").onclick=()=>{
  renderCart();
  cartModal.style.display="block";
};
closeCart.onclick=()=>cartModal.style.display="none";
checkoutBtn.onclick=()=>{
  cartModal.style.display="none";
  checkoutModal.style.display="block";
};
closeCheckout.onclick=()=>checkoutModal.style.display="none";

function generateOrderCode(){
  const n = new Date();
  return `TLTT-${n.getFullYear().toString().slice(-2)}${String(n.getMonth()+1).padStart(2,'0')}${String(n.getDate()).padStart(2,'0')}-${n.getTime().toString().slice(-4)}`;
}

orderForm.addEventListener("submit",()=>{
  orderCode.value = generateOrderCode();

  let c = loadCart(), total=0, detail="";
  c.forEach(ci=>{
    let b=books.find(x=>x.id===ci.id);
    total+=b.price*ci.qty;
    detail+=`${b.title} x ${ci.qty} = ${formatVND(b.price*ci.qty)}\n`;
  });

  orderDetail.value = detail;
  orderTotal.value = formatVND(total);
  localStorage.removeItem(CART_KEY);
});

updateCartCount();

function downloadFree(){
  window.open("previews/tuyet-mat-nhan-tinh-doc-thu.pdf","_blank");
}
</script>

</body>
</html>
